#include <unistd.h>
#include <stdio.h>
#include <dirent.h>
#include <string.h>
#include <sys/stat.h>
#include <stdlib.h>

void printenv(char **env);
int _setenv(char **env, char *varN, char* varV, int overwrite);
char **copyEnv(char **env);

int main(int ac, char **av, char **env_org)
{
        unsigned int i = 0;

        while(env_org[i])
                i++;

        char **env = copyEnv(env_org);

        i = 0;

        printenv(env);
        printf("----------------------------\n");
        _setenv(env, "NEWVAR1", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR2", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR3", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR4", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR5", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR6", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR7", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR8", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR9", "asdasdojieijoijowejiewrwer", 1);
        // _setenv(env, "NEWVAR10", "asdasdojieijoijowejiewrwer", 1);
        printenv(env);

        while(env[i])
                free(env[i]), i++;

        free(env);

        return (0);
}

char **copyEnv(char **env)
{
        unsigned int i = 0;
        char **newEnv;

        while(env[i])
                i++;
        
        newEnv = calloc(i, sizeof(char*));

        for(i = 0; env[i]; i++)
        {
                newEnv[i] = calloc(strlen(env[i]), sizeof(char));
                memcpy(newEnv[i], env[i], strlen(env[i]));
                printf("i: %i, coping: %s\n", i, newEnv[i]);
        }

        newEnv[i] = 0;

        return newEnv;
}

int _setenv(char **env, char *varN, char* varV, int overwrite)
{
        int i;
        int buff_size = strlen(varN) + strlen(varV) + 2;
        char *buff = calloc(buff_size, sizeof(char));
        strcat(buff, varN);
        strcat(buff, "=");
        strcat(buff, varV);
        buff[buff_size - 1] = 0;


        for (i = 0; env[i]; i++)
                if (strncmp(env[i], varN, strlen(varN)) == 0)
                {
                        env[i] = buff;
                        return (1);
                }
                
        // env = realloc(env, sizeof(char) *  i + 1);

        env[i] = buff;
        env[i + 1] = 0;
        return (1);
}

void printenv(char **env)
{
        int i = 0;

        while (env[i] != NULL)
        {
                printf("%s\n", env[i]);
                i++;
        }
}
